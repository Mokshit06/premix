/**
* Built with Premix
* Learn more at https://github.com/Mokshit06/premix
*/
var at=Object.create,L=Object.defineProperty,nt=Object.getPrototypeOf,st=Object.prototype.hasOwnProperty,it=Object.getOwnPropertyNames,ct=Object.getOwnPropertyDescriptor;var ut=e=>L(e,"__esModule",{value:!0});var f=(e,t)=>()=>(e&&(t=e(e=0)),t),I=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),N=(e,t)=>{for(var r in t)L(e,r,{get:t[r],enumerable:!0})},lt=(e,t,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of it(t))!st.call(e,o)&&o!=="default"&&L(e,o,{get:()=>t[o],enumerable:!(r=ct(t,o))||r.enumerable});return e},h=e=>lt(ut(L(e!=null?at(nt(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var a,u=f(()=>{a=h(require("react"))});var P=I(q=>{u();var pt=Object.create,E=Object.defineProperty,mt=Object.getPrototypeOf,X=Object.prototype.hasOwnProperty,dt=Object.getOwnPropertyNames,ft=Object.getOwnPropertyDescriptor,Z=Object.getOwnPropertySymbols,ht=Object.prototype.propertyIsEnumerable,ee=(e,t,r)=>t in e?E(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,U=(e,t)=>{for(var r in t||(t={}))X.call(t,r)&&ee(e,r,t[r]);if(Z)for(var r of Z(t))ht.call(t,r)&&ee(e,r,t[r]);return e},te=e=>E(e,"__esModule",{value:!0}),gt=(e,t)=>{for(var r in t)E(e,r,{get:t[r],enumerable:!0})},_t=(e,t,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of dt(t))!X.call(e,o)&&o!=="default"&&E(e,o,{get:()=>t[o],enumerable:!(r=ft(t,o))||r.enumerable});return e},y=e=>_t(te(E(e!=null?pt(mt(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);te(q);gt(q,{Form:()=>Ot,Links:()=>St,LiveReload:()=>At,Meta:()=>Et,PremixProvider:()=>xt,Scripts:()=>Ft,loadable:()=>re,makeRoutes:()=>jt,matchRoute:()=>vt,usePendingFormSubmit:()=>bt,usePendingLocation:()=>Pt,usePremix:()=>S,useRouteData:()=>wt,useSetPendingLocation:()=>yt,useSubmit:()=>oe});var Lt=y(require("react")),s=y(require("react")),Mt=y(require("react-error-boundary")),ae=y(require("react-router-dom"));async function Ct(e){return await(await fetch(`/_premix/data?href=${e}`)).json()}var M=y(require("react"));function kt(){let[,e]=(0,M.useState)({});return(0,M.useCallback)(()=>{e({})},[])}function re(e,{fallback:t=r=>null}={}){return function(o){var n;let i=(0,M.useRef)(t),c=kt();return((n=globalThis.__LOADABLE_CACHE__)==null?void 0:n[e.toString()])&&(i.current=globalThis.__LOADABLE_CACHE__[e.toString()]),(0,M.useEffect)(()=>{var l;((l=globalThis.__LOADABLE_CACHE__)==null?void 0:l[e.toString()])||e(o).then(m=>{i.current=m.default,c()})},[]),Lt.createElement(i.current,U({},o))}}var Dt=y(require("path-to-regexp"));function vt(e,t){return(0,Dt.pathToRegexp)(e).test(t)}var B=(0,s.createContext)(null),H=(0,s.createContext)(null),ne=(0,s.createContext)(null);function Rt({error:e}){return s.default.createElement("div",{role:"alert"},s.default.createElement("p",null,"Something went wrong:"),s.default.createElement("pre",null,e.message))}function xt({context:e,children:t}){let r=(0,s.useState)(e),o=(0,s.useState)(null),n=(0,s.useState)(!1);return s.default.createElement(Mt.ErrorBoundary,{FallbackComponent:Rt},s.default.createElement(B.Provider,{value:r},s.default.createElement(H.Provider,{value:n},s.default.createElement(ne.Provider,{value:o},t))))}var S=()=>{let e=(0,s.useContext)(B);if(e===null)throw new Error("usePremix must be called inside <PremixContext />");return e},se=()=>(0,s.useContext)(ne);function bt(){let[e]=se();return e}var yt=()=>(0,s.useContext)(H);function Pt(){let[e]=(0,s.useContext)(H);return e}function wt(){let[{data:e}]=(0,s.useContext)(B);return e.props}function Et(){let[{meta:e}]=S();return s.default.createElement(s.default.Fragment,null,e.title&&s.default.createElement(s.default.Fragment,null,s.default.createElement("title",null,e.title),s.default.createElement("meta",{name:"title",content:e.title})),Object.entries(e).map(([t,r])=>t!=="title"&&s.default.createElement("meta",{key:t,name:t,content:r})))}function St(){let[{links:e}]=S();return s.default.createElement(s.default.Fragment,null,e.map(t=>s.default.createElement(s.Fragment,{key:t.href},["preload","modulepreload"].includes(t.rel)?s.default.createElement("link",{rel:t.rel,as:t.as,href:t.href}):s.default.createElement(s.default.Fragment,null,s.default.createElement("link",{rel:"preload",as:"style",href:t.href,media:t.media}),s.default.createElement("link",{rel:t.rel,href:t.href,media:t.media})))))}function Ft(){let[e]=S();return s.default.createElement(s.default.Fragment,null,s.default.createElement("script",{id:"__PREMIX_DATA__",type:"application/json",dangerouslySetInnerHTML:{__html:JSON.stringify(e)}}),s.default.createElement("script",{type:"module",src:e.script}))}function At({url:e="http://localhost:3456"}){return null}function Tt(...e){return t=>{e.forEach(r=>{typeof r=="function"?r(t):r!=null&&(r.current=t)})}}function oe(e){let t=(0,ae.useLocation)(),r=(0,ae.useNavigate)(),[,o]=S(),n=e||t.pathname;return async(i,{replace:c=!1,method:l="post"}={})=>{let m=await fetch(n,{method:l,body:new URLSearchParams(i)}),p=new URL(m.url).pathname;if(m.redirected)if(p===window.location.pathname){let _=await Ct(p);o(_)}else window.location.assign(p);else console.log(m)}}var Ot=(0,s.forwardRef)(({children:e,action:t,replace:r=!1,method:o="post"},n)=>{let[,i]=se(),c=(0,s.useRef)(null),l=oe(t),m=async p=>{p.preventDefault();let _=new FormData(c.current);i(_),await l(_,{replace:r,method:o}),i(null)};return s.default.createElement("form",{method:"post",action:t,ref:Tt(c,n),onSubmit:m},e)});function jt(e){return e.map(t=>U(U({},t),{component:t.component||re(t.page)}))}});var ie=f(()=>{});var ce,ue=f(()=>{u();ie();ce="_5c4di50"});function V(e){return a.createElement("button",{...e,className:ce})}var le=f(()=>{u();ue()});var pe,C,me=f(()=>{u();pe=h(require("@prisma/client")),C=new pe.PrismaClient({})});var de=f(()=>{});var k=f(()=>{});var fe={};N(fe,{action:()=>qt,default:()=>he,loader:()=>Nt,meta:()=>It});function he(){let{todos:e}=(0,x.useRouteData)(),t=(0,x.usePendingFormSubmit)(),r=(0,F.useRef)(),o=(0,x.useSubmit)();return(0,F.useEffect)(()=>{t&&r.current.reset()},[t]),(0,F.useEffect)(()=>{console.log(e)},[e]),a.createElement("main",null,a.createElement("h2",null,"Todos"),a.createElement("ul",null,(e||[]).map(n=>a.createElement("li",{key:n.id},a.createElement("input",{type:"checkbox",checked:n.complete,onChange:i=>{o({id:n.id,complete:i.target.checked},{replace:!0,method:"put"})}}),n.text)),t&&a.createElement("li",null,a.createElement("input",{type:"checkbox",disabled:!0}),t.get("text"))),a.createElement(x.Form,{ref:r,action:"/todos"},a.createElement("label",null,"Todo:",a.createElement("input",{name:"text",type:"text"})),a.createElement(V,{type:"submit"},"Create")))}var F,x,It,Nt,qt,ge=f(()=>{u();F=h(require("react")),x=h(P());le();me();de();k();It=()=>({title:"Todos"}),Nt=async()=>({props:{todos:await C.todo.findMany()}}),qt=async(e,t)=>{switch(e.method){case"POST":{await C.todo.create({data:{text:e.body.text}});break}case"PUT":{await C.todo.update({where:{id:Number(e.body.id)},data:{complete:JSON.parse(e.body.complete)}});break}}t.redirect(303,"/todos")}});var _e,ve=f(()=>{_e="/build/dummy_image-HIYKDFKE.webp"});var xe,be=f(()=>{xe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAICAIAAABPmPnhAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAUElEQVQImWO4ixcwQKhLYIDMQJH+AgP/weDFixco0j4+PhoaGu3t7fHx8QwMDJMmTYKoAElfunTJysrK0NAwMzMTIt3e3o6QJmw4Aafh8hgA3gG9oNJvKVQAAAAASUVORK5CYII="});function $({className:e}){return a.createElement("img",{height:375,width:500,src:_e,loading:"lazy",style:{backgroundImage:`url(${xe})`,backgroundSize:"cover"},className:e})}var ye=f(()=>{u();ve();be()});var Pe={};N(Pe,{default:()=>Ee,loader:()=>Kt,meta:()=>Ht});function Ee(){let{posts:e}=(0,we.useRouteData)();return a.createElement(a.Fragment,null,a.createElement($,null),e.map(t=>a.createElement("div",{key:t.id},a.createElement("a",{href:`/${t.id}`},t.title))))}var we,Ht,Kt,Se=f(()=>{u();ye();we=h(P());k();Ht=()=>({title:"Posts"}),Kt=async()=>({props:{posts:await(await fetch("https://jsonplaceholder.typicode.com/posts?_limit=5")).json()}})});var Fe={};N(Fe,{default:()=>Oe,loadPaths:()=>$t,loader:()=>Jt,meta:()=>Vt});function Oe(){let{post:e}=(0,Ae.useRouteData)();return a.createElement(a.Fragment,null,a.createElement("a",{href:"/"},"Home"),a.createElement("h2",null,e.title),a.createElement("p",null,e.body))}var Ae,Vt,$t,Jt,je=f(()=>{u();Ae=h(P());k();Vt=({post:e})=>({title:e.title,description:e.body}),$t=async()=>({paths:(await(await fetch("https://jsonplaceholder.typicode.com/posts?_limit=5")).json()).map(r=>({params:{post:r.id}}))}),Jt=async({params:e})=>({props:{post:await(await fetch(`https://jsonplaceholder.typicode.com/posts/${e.post}`)).json()}})});var He=I(J=>{u();var Qt=Object.create,A=Object.defineProperty,Yt=Object.getPrototypeOf,Q=Object.prototype.hasOwnProperty,Wt=Object.getOwnPropertyNames,zt=Object.getOwnPropertyDescriptor,D=Object.getOwnPropertySymbols,Le=Object.prototype.propertyIsEnumerable,Me=(e,t,r)=>t in e?A(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ce=(e,t)=>{for(var r in t||(t={}))Q.call(t,r)&&Me(e,r,t[r]);if(D)for(var r of D(t))Le.call(t,r)&&Me(e,r,t[r]);return e},ke=e=>A(e,"__esModule",{value:!0}),Gt=(e,t)=>{var r={};for(var o in e)Q.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(e!=null&&D)for(var o of D(e))t.indexOf(o)<0&&Le.call(e,o)&&(r[o]=e[o]);return r},Xt=(e,t)=>{for(var r in t)A(e,r,{get:t[r],enumerable:!0})},Zt=(e,t,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Wt(t))!Q.call(e,o)&&o!=="default"&&A(e,o,{get:()=>t[o],enumerable:!(r=zt(t,o))||r.enumerable});return e},g=e=>Zt(ke(A(e!=null?Qt(Yt(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);ke(J);Xt(J,{createRequestHandler:()=>er});var R=g(require("react")),tr=g(require("express")),rr=g(require("node-fetch")),or=g(require("path-to-regexp"));function De(e,t){return(0,or.pathToRegexp)(e).test(t)}var ar=g(require("path-to-regexp")),nr=g(require("react-router-dom/server")),sr=g(require("url")),d=g(require("react")),ir=g(require("react-error-boundary")),Re=g(require("react-router-dom"));async function cr(e){return await(await fetch(`/_premix/data?href=${e}`)).json()}var eo=g(require("react")),Te=(0,d.createContext)(null),ur=(0,d.createContext)(null),Ie=(0,d.createContext)(null);function lr({error:e}){return d.default.createElement("div",{role:"alert"},d.default.createElement("p",null,"Something went wrong:"),d.default.createElement("pre",null,e.message))}function pr({context:e,children:t}){let r=(0,d.useState)(e),o=(0,d.useState)(null),n=(0,d.useState)(!1);return d.default.createElement(ir.ErrorBoundary,{FallbackComponent:lr},d.default.createElement(Te.Provider,{value:r},d.default.createElement(ur.Provider,{value:n},d.default.createElement(Ie.Provider,{value:o},t))))}var mr=()=>{let e=(0,d.useContext)(Te);if(e===null)throw new Error("usePremix must be called inside <PremixContext />");return e},dr=()=>(0,d.useContext)(Ie);function fr(...e){return t=>{e.forEach(r=>{typeof r=="function"?r(t):r!=null&&(r.current=t)})}}function hr(e){let t=(0,Re.useLocation)(),r=(0,Re.useNavigate)(),[,o]=mr(),n=e||t.pathname;return async(i,{replace:c=!1,method:l="post"}={})=>{let m=await fetch(n,{method:l,body:new URLSearchParams(i)}),p=new URL(m.url).pathname;if(m.redirected)if(p===window.location.pathname){let _=await cr(p);o(_)}else window.location.assign(p);else console.log(m)}}var to=(0,d.forwardRef)(({children:e,action:t,replace:r=!1,method:o="post"},n)=>{let[,i]=dr(),c=(0,d.useRef)(null),l=hr(t),m=async p=>{p.preventDefault();let _=new FormData(c.current);i(_),await l(_,{replace:r,method:o}),i(null)};return d.default.createElement("form",{method:"post",action:t,ref:fr(c,n),onSubmit:m},e)}),gr=g(require("fs")),_r=g(require("path"));function Ne(e,t){let{imports:r}=e.outputs[t];return[...new Set(r.filter(o=>o.kind==="import-statement").flatMap(o=>[o.path.replace(/^public/,""),...Ne(e,o.path)]))]}function vr(e){let{outputs:t}=e;for(let[r,o]of Object.entries(t))if(o.entryPoint==="app/entry-client.tsx")return r}function xr(){let e=gr.default.readFileSync(_r.default.join(process.cwd(),"build/meta.json"),"utf8");if(!e)throw new Error("`build/meta.json` not found. Run `yarn build`");return JSON.parse(e)}function br(e,t){let{outputs:r}=e,o=[];return Object.entries(r).forEach(([n,i])=>{i.imports.filter(c=>c.kind==="import-statement").some(c=>c.path===t)&&o.push(n)}),o}function yr(e,t){let{outputs:r}=e,o=[];return Object.entries(r).forEach(([n,i])=>{Object.keys(i.inputs).includes(t)&&o.push(n)}),o}function Pr(e){let{inputs:t}=e,r=[];return Object.keys(t).forEach(o=>{let n=new URL(`https://example.com/${o}`),i=/\.css$/.test(n.pathname),c=/^\/url-file:(.*)\.css$/.test(n.pathname);!i||c||r.push(o)}),r.map(o=>yr(e,o)).reduce((o,n)=>{let[i,c]=n,l=br(e,i);return l.length===0&&l.push(i),Ce(Ce({},o),{[c]:l})},{})}function wr(e,t){let{outputs:r}=e;for(let[o,n]of Object.entries(r))if(n.entryPoint===t)return o}var O,qe,Y,Ue;O=xr(),Y=vr(O),qe=Ne(O,Y),Ue=Pr(O);async function Be(e){let t=new sr.URL(`https://example.com${e}`).pathname,r=globalThis.__PREMIX_MANIFEST__.find(b=>De(b.path,t));if(!r)return[{notFound:!0}];let o=r.pagePath,n=wr(O,o)||"",i=await r.page(),c={links:i.links||(()=>[]),meta:i.meta||(()=>({})),loader:i.loader||(async()=>({props:{}})),default:i.default||(()=>R.createElement("h1",null,"404")),headers:i.headers||(()=>({}))},l=(0,ar.match)(r.path,{decode:decodeURIComponent})(t);if(!l)return;let{params:m}=l,p=await c.loader({params:m}),_=c.meta(p.props),Ze=c.headers(p.props),et=i.default,z=[];for(let[b,tt]of Object.entries(Ue)){let rt=b.replace(/^public/,"");tt.some(ot=>ot===n)&&z.push(rt)}let T=Y.replace(/^public/,""),G=[{rel:"modulepreload",href:T},{rel:"modulepreload",href:n.replace(/^public/,"")},...qe.map(b=>({rel:"modulepreload",href:b})),...z.map(b=>({rel:"stylesheet",href:b})),...c.links(p.props)];return[()=>R.createElement(pr,{context:{meta:_,links:G,data:p,script:T}},R.createElement(nr.StaticRouter,{location:e},R.createElement(globalThis.App,{Component:et}))),{links:G,data:p,meta:_,params:m,script:T,headers:Ze}]}global.fetch=rr.default;var Er=globalThis.__PREMIX_MANIFEST__;function er(e){let t=(0,tr.Router)();return t.get("/_premix/data",async(r,o)=>{let{href:n}=r.query;if(!n)return o.status(404).send();try{let[{notFound:i},c]=await Be(n),l=c,{headers:m}=l,p=Gt(l,["headers"]);if(i===!0)return o.status(404).send("Page not found");o.json(p)}catch(i){console.log(i.message),o.status(500).send()}}),t.get("*",async(r,o)=>{let[n,i]=await Be(r.originalUrl);if(n.notFound===!0)return o.status(404).send("Page not found");let{headers:c}=i,l=e(n);Object.entries(c).forEach(([m,p])=>o.setHeader(m,p)),o.send(l)}),t.all("*",async(r,o)=>{let n=Er.find(c=>De(c.path,r.originalUrl));if(!n)return o.status(404).send("Page not found");console.log(n);let{action:i}=await n.page();if(!i)return o.status(404).send("Loader doesn't exist");await i(r,o)}),t}});var Ve=I((oo,Ke)=>{u();Ke.exports=He()});function W(e){return`<!DOCTYPE html>${$e.default.renderToString(Je.default.createElement(e,null))}`}var $e,Je,Qe=f(()=>{u();$e=h(require("react-dom/server")),Je=h(require("react"))});var Sr={};var j,Ye,We,ze,w,Ge=f(()=>{u();j=h(require("express")),Ye=h(Ve()),We=h(require("compression")),ze=h(require("chalk"));Qe();w=(0,j.default)();w.use((0,We.default)());w.use(j.default.static("public"));w.use(j.default.json());w.use(j.default.urlencoded({extended:!0}));w.use("/",(0,Ye.createRequestHandler)(W));w.listen(process.env.PORT,()=>{console.log(ze.default.green`Server started on http://localhost:3000`)})});u();var Xe=h(P());u();var v=h(P());function K({Component:e}){return a.createElement("html",{lang:"en"},a.createElement("head",null,a.createElement("meta",{charSet:"UTF-8"}),a.createElement("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),a.createElement(v.Meta,null),a.createElement(v.Links,null)),a.createElement("body",null,a.createElement("div",{id:"__premix"},a.createElement(e,null)),a.createElement(v.Scripts,null),a.createElement(v.LiveReload,null)))}globalThis.App=K;globalThis.__PREMIX_MANIFEST__=(0,Xe.makeRoutes)([{path:"/todos",page:()=>Promise.resolve().then(()=>(ge(),fe)),pagePath:"/root/projects/react-ssr/packages/example/app/pages/todos.tsx"},{path:"/",page:()=>Promise.resolve().then(()=>(Se(),Pe)),pagePath:"/root/projects/react-ssr/packages/example/app/pages/index.tsx"},{path:"/:post",page:()=>Promise.resolve().then(()=>(je(),Fe)),pagePath:"/root/projects/react-ssr/packages/example/app/pages/$post.tsx"}]);Ge();
//# sourceMappingURL=/build/server.js.map
